(this["webpackJsonpmini-blog-admin"]=this["webpackJsonpmini-blog-admin"]||[]).push([[0],{149:function(e,t,a){},151:function(e,t,a){"use strict";a.r(t);var n=a(1),l=a.n(n),o=a(22),i=a.n(o),r=a(23),c=a(21),s=a(20),u=a(13),d=a(14),m=a(16),h=a(15),g=a(17),f=a(165),v=a(166),E=a(152),p=a(153),b=a(154),k=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).onNavChange=function(e){(0,a.props.onChange)(e)},a.state={},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.currentKey,n=t.links;return l.a.createElement(E.a,{tabs:!0},n.map((function(t,n){return l.a.createElement(p.a,{onClick:function(){e.onNavChange(n)}},l.a.createElement(b.a,{active:n==a},t.name))})))}}]),t}(l.a.Component),S=a(7),O=a(158),C=a(160),y=a(161),j=a(162),w=a(163),A="travel-pet-1",T=a(155),N=function(e){var t=e.title,a=void 0===t?"111":t,n=e.alertVisible,o=void 0!==n&&n;return l.a.createElement(T.a,{color:"info",isOpen:o},a)},L=a(167),M=a(156),_=a(157),I=function(e){var t=e.isShow,a=void 0!==t&&t,n=e.title,o=void 0===n?"":n,i=e.onOk,r=void 0===i?function(){}:i,c=e.onCancel,s=void 0===c?function(){}:c,u=e.id,d=void 0===u?"":u;return l.a.createElement(L.a,{isOpen:a},l.a.createElement(M.a,null,o),l.a.createElement(_.a,null,l.a.createElement(O.a,{color:"primary",onClick:function(){return r(d)}},"Ok")," ",l.a.createElement(O.a,{color:"secondary",onClick:function(){return s()}},"Cancel")))},x=a(159),K=(a(74),function(e){var t=e.visible,a=void 0===t||t;return l.a.createElement("div",{className:"jy-loading",style:{display:a?"flex":"none"}},l.a.createElement(x.a,{color:"primary"}))}),P=a(24),J=a.n(P);function V(e,t,a,n){return new Promise((function(l,o){J.a.post("/weixinapi/tcb/invokecloudfunction?access_token=".concat(e,"&env=").concat(n,"&name=").concat(t),a).then((function(e){console.log(e),200==e.status&&0==e.data.errcode?l(e.data):42001==e.data.errcode?o("assesstoken overtime"):o("youwenti")})).catch((function(e){o(e.data)}))}))}var W=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).getArticleList=function(){a.setState({loading:!0});var e=a.props,t=e.accessToken,n=e.isLogin,l=a.state;V(t,"getArticleList",{pageSize:l.pageSize,pageNum:l.pageNum},A).then((function(e){if(console.log(e),a.setState({loading:!1}),0==e.errcode){var t=JSON.parse(e.resp_data);"collection.get:ok"==t.errMsg?a.setState({articles:t.data}):alert("query wrong")}else n(!1)})).catch((function(e){n(!1),a.setState({loading:!1})}))},a.lastPage=function(){var e=a.state.pageNum;--e<1&&(e=1),a.setState({pageNum:e},(function(){a.getArticleList()}))},a.nextPage=function(){var e=a.state.pageNum;e++,a.setState({pageNum:e},(function(){a.getArticleList()}))},a.deleteArticle=function(e){a.setState({deleteId:e}),a.deleteModalToggle()},a.deleteModalToggle=function(){a.state.deleteModalShow=!a.state.deleteModalShow,a.setState()},a.closeAlert=function(){setTimeout((function(){a.setState({alertVisible:!1})}),3e3)},a.onDeleteOk=function(e){var t=a.props.accessToken,n=(a.state.deleteId,Object(S.a)(a));V(t,"deleteArticle",{id:e},A).then((function(e){if(console.log(e),a.setState({loading:!1}),0==e.errcode){var t=JSON.parse(e.resp_data);console.log(t),n.getArticleList(),n.setState({alertTitle:"\u5220\u9664\u6210\u529f"}),n.setState({alertVisible:!0}),n.closeAlert()}else n.setState({alertTitle:"\u5220\u9664\u5931\u8d25"}),n.setState({alertVisible:!0}),n.closeAlert()})).catch((function(e){alert(e),a.setState({loading:!1})})),a.state.deleteModalShow=!a.state.deleteModalShow,a.state.deleteId="",a.setState()},a.state={loading:!1,articles:[],pageSize:10,pageNum:1,deleteModalShow:!1,alertVisible:!1,alertTitle:""},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){this.getArticleList()}},{key:"render",value:function(){var e=this,t=this.state,a=t.loading,n=t.articles,o=t.pageNum,i=t.deleteModalShow,r=t.alertVisible,c=t.alertTitle,s=t.deleteId,u=this.props.goToEdit;return l.a.createElement("div",{style:{width:"100%"}},!a&&l.a.createElement("div",{style:{width:"100%"}},l.a.createElement(O.a,{onClick:function(){e.getArticleList()}},"refresh"),l.a.createElement(N,{title:c,alertVisible:r}),l.a.createElement(C.a,null,l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"title"),l.a.createElement("th",null,"author"),l.a.createElement("th",null,"operation"))),l.a.createElement("tbody",null,this.state.articles.map((function(t){return l.a.createElement("tr",{key:t._id},l.a.createElement("td",null,t.title),l.a.createElement("td",null,t.author),l.a.createElement("td",null,l.a.createElement(O.a,{color:"danger",onClick:function(){e.deleteArticle(t._id)}},"delete"),l.a.createElement(O.a,{color:"info",onClick:function(){u(t._id)}},"edit")))})),0==this.state.articles.length&&l.a.createElement("tr",null,l.a.createElement("th",null,"no more")))),l.a.createElement(y.a,{size:"lg","aria-label":"Page navigation"},l.a.createElement(j.a,null,l.a.createElement(w.a,{first:!0,onClick:function(){e.lastPage()},disabled:1==o})),l.a.createElement(j.a,null,l.a.createElement(w.a,{last:!0,onClick:function(){e.nextPage()},disabled:0==n.length})))),l.a.createElement(I,{isShow:i,onOk:this.onDeleteOk,onCancel:function(){e.setState({deleteModalShow:!1})},title:"Are you sure to delete this?",id:s}),l.a.createElement(K,{visible:a}))}}]),t}(l.a.Component),z=a(55),D=a(164),q=a(56),B=a.n(q),H=a(57),Y=a.n(H),$=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).saveArticle=function(e){var t=a.props,n=t.accessToken,l=t.changeTab,o=t.isLogin,i=a.state,r=i.htmlContent,c=i.mdContent,s=i.title,u=i.author,d=i._id;if(s&&u){var m={_id:d,title:s,author:u,mdContent:c,htmlContent:r,status:e};a.setState({loading:!0}),V(n,"addArticle",m,A).then((function(e){if(console.log(e),a.setState({loading:!1}),0==e.errcode){var t=JSON.parse(e.resp_data);console.log(t),l(0)}else o(!1)})).catch((function(e){o(!1),a.setState({loading:!1})}))}else alert("can not save")},a.state={_id:"",mdContent:"",htmlContent:"",title:"",author:"Jesse Yang",loading:!1},a.mdParser=new Y.a,a.handleEditorChange=a.handleEditorChange.bind(Object(S.a)(a)),a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){var e=this,t=this.props,a=t.currentArticleId,n=t.accessToken,l=t.isLogin;console.log(a);var o=this;a&&V(n,"getArticleDetail",{id:a},A).then((function(t){if(console.log(t),e.setState({loading:!1}),0==t.errcode){var a=JSON.parse(t.resp_data);console.log(a.data),o.setState(Object(z.a)({},e.state,{},a.data))}else l(!1)})).catch((function(t){l(!1),e.setState({loading:!1})}))}},{key:"handleEditorChange",value:function(e){var t=e.html,a=e.text;console.log("handleEditorChange",t,a),this.setState({htmlContent:t,mdContent:a})}},{key:"render",value:function(){var e=this,t=(this.props.data,this.state),a=t.author,n=t.title,o=t.loading,i=t.mdContent;return l.a.createElement("div",{style:{width:"100%"}},l.a.createElement(O.a,{color:"primary",onClick:function(){e.saveArticle("save")}},"save"),l.a.createElement(O.a,{color:"info",onClick:function(){e.saveArticle("submit")}},"submit"),l.a.createElement("hr",null),"title:",l.a.createElement(D.a,{invalid:!n,value:n,onChange:function(t){e.setState({title:t.target.value})}}),"author:",l.a.createElement(D.a,{invalid:!a,value:a,onChange:function(t){e.setState({author:t.target.value})}}),"content:",l.a.createElement("div",{style:{height:"800px"}},l.a.createElement(B.a,{value:i,renderHTML:function(t){return e.mdParser.render(t)},onChange:this.handleEditorChange})),l.a.createElement(K,{visible:o}))}}]),t}(l.a.Component),F=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).state={token:""},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.isShow,n=t.onSave;return l.a.createElement(L.a,{isOpen:a},l.a.createElement(M.a,null,l.a.createElement("div",null,l.a.createElement("p",null,"fbc1eb50f578ba35b11d4ff61b39847b wx9bbf102997e7c9d9"),l.a.createElement("a",{href:"https://mp.weixin.qq.com/debug/",target:"_blank"},"token\u5931\u6548\u3002\u70b9\u51fb\u8fd9\u91cc\u83b7\u53d6token\uff0c\u7c98\u8d34\u5230\u4e0b\u65b9"),l.a.createElement(D.a,{onChange:function(t){e.setState({token:t.target.value})}}))),l.a.createElement(_.a,null,l.a.createElement(O.a,{color:"primary",onClick:function(){n(e.state.token)}},"Ok")," "))}}]),t}(l.a.Component),G=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).onAccessTokenChange=function(e){a.setState({accessToken:e.target.value})},a.state={accessToken:"",navs:[{key:0,name:"\u5217\u8868",href:"/"},{key:1,name:"\u65b0\u589e/\u7f16\u8f91",href:"/home"}],currentNavKey:0,isLogin:!0},a}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentWillMount",value:function(){this.setState({accessToken:localStorage.getItem("article_token")})}},{key:"render",value:function(){var e,t=this,a=this.state,n=a.accessToken,o=a.currentNavKey,i=a.currentArticleId,r=a.isLogin;return l.a.createElement("div",null,l.a.createElement(f.a,{className:"themed-container"},l.a.createElement(v.a,null,l.a.createElement(k,{currentKey:o,links:this.state.navs,onChange:function(e){t.setState({currentNavKey:e,currentArticleId:""})}})),l.a.createElement(v.a,null,0==this.state.currentNavKey&&l.a.createElement(W,{isLogin:function(e){t.setState({isLogin:e})},accessToken:n,goToEdit:function(e){t.setState({currentNavKey:1,currentArticleId:e})}}),1==this.state.currentNavKey&&l.a.createElement($,(e={isLogin:function(e){t.setState({isLogin:e})},currentArticleId:i},Object(s.a)(e,"isLogin",(function(e){t.setState({isLogin:e})})),Object(s.a)(e,"accessToken",n),Object(s.a)(e,"changeTab",(function(e){return t.setState({currentNavKey:e})})),e)))),l.a.createElement(F,{isShow:!r,onSave:function(e){t.setState({accessToken:e,isLogin:!0}),localStorage.setItem("article_token",e)}}))}}]),t}(l.a.Component),Q=Object(c.f)(G);function R(){return l.a.createElement("div",null,l.a.createElement("h2",null,"About"))}function U(){return l.a.createElement("div",null,l.a.createElement("h2",null,"Dashboard"))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(149),a(150);i.a.render(l.a.createElement((function(){return l.a.createElement(r.a,null,l.a.createElement("div",null,l.a.createElement(c.c,null,l.a.createElement(c.a,{exact:!0,path:"/"},l.a.createElement(Q,null)),l.a.createElement(c.a,{path:"/about"},l.a.createElement(R,null)),l.a.createElement(c.a,{path:"/dashboard"},l.a.createElement(U,null)))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},60:function(e,t,a){e.exports=a(151)},74:function(e,t,a){}},[[60,1,2]]]);
//# sourceMappingURL=main.a1c775e9.chunk.js.map